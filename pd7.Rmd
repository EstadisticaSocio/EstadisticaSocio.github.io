---
title: "Pr谩ctica dirigida 7"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: flatly
    highlight: textmate
    always_allow_html: yes
editor_options: 
  markdown: 
    wrap: 72
---

**FACULTAD DE CIENCIAS SOCIALES - PUCP**

Curso: SOC294 - Estad铆stica para el an谩lisis sociol贸gico 1

Semestre 2024 - 2

# **I. An谩lisis de regresi贸n lineal simple (RLS): ideas clave**

T茅cnica estad铆stica que predice el valor de una variable con los valores de otra. La regresi贸n lineal simple es un m茅todo 煤til para predecir una respuesta cuantitativa **Y** partiendo de una sola variable predictora **X**, asumiendo que hay una relaci贸n aproximadamente lineal entre X e Y. Matem谩ticamente, esta relaci贸n lineal se representa como

**Y = a + bX + E**

-   Y = variable dependiente o explicada. Variable cuyos valores se desea predecir o resumir. Un modelo de regresi贸n lineal tiene como variable dependiente una variable num茅rica

-   a = Constante: ordenada en el origen, valor esperado de "Y" cuando X=0

-   b = Pendiente: mide el cambio de la variable "Y" por cada unidad de cambio de "X". Su magnitud sirve para predecir en cu谩nto aumentar谩 "y" cada vez que "x" se incremente en una unidad.Su signo puede ser positivo o negativo, y en esto la interpretaci贸n coincide con la correlaci贸n.

-   X = variable utilizada para predecir el valor de la variable dependiente. Tambi茅n se denomina variable predictora o variable explicativa. Las variables explicativas que son parte del modelo suelen ser num茅ricas o intervalares; sin embargo, es posible incorporar variables explicativas ordinales o categ贸ricas.

-   E = Corresponde a las desviaciones de los valores verdaderos de Y con respecto a los valores esperados de "Y" (diferencia entre lo observado y estimado por el modelo). Asumimos que es independiente de "X".

La relaci贸n entre las variables depende de la pendiente:

-   Si b es positivo, Y aumenta cuando X aumenta. Es una relaci贸n directa / positiva.

-   Si b es negativo, Y aumenta cuando X disminuye. Es una relaci贸n inversa / negativa.

-   Si b es cero.Y no cambia cuando X var铆a. No existe relaci贸n entre las variables.

Asimismo, con el m茅todo de la regresi贸n lineal se puede responder las siguientes preguntas:

-   Analizar si hay una **asociaci贸n** entre las variables mediante un test de independencia estad铆stica.

-   Analizar la **direcci贸n** de la asociaci贸n (directa o inversa).

-   Evaluar la **fuerza** de la asociaci贸n usando una medida de asociaci贸n llamada *correlaci贸n de Pearson*.

-   Estimar una ecuaci贸n de regresi贸n que **"predice"** los valores de la variable dependiente para valores de la variable independiente.

# **II. An谩lisis de regresi贸n lineal m煤ltiple (RLM): ideas clave**

Hasta el momento, nos hemos encontrado en el campo del an谩lisis bivariado.
Sin embargo, en el mundo social, dif铆cilmente se pueden explicar los fen贸menos de inter茅s con una sola variable.
Incluso si nos interesa evaluar el efecto de un a variable en espec铆fico sobre un fen贸meno de estudio, hay muchos otros factores que podr铆an influir en aquello que nos interesa explorar.
Por ello, necesitamos recurrir al **an谩lisis multivariado** y conocer el concepto de **control estad铆stico**.

El control estad铆stico nos permite aislar el efecto de otras variables.
La idea es:

-   Evaluar si la asociaci贸n entre X e Y permanece si se remueve el efecto de otra variable, es decir, si se controla por una tercera variable.

-   Se analiza la relaci贸n entre X e Y para valores similares o iguales de una variable Z.
    De esta manera se elimina la influencia de Z en la relaci贸n entre X e Y.
    Lo anterior nos ayuda a acercarnos a una interpretaci贸n causar X -\> Y.

-   Si la relaci贸n entre X e Y desaparece cuando se controla por Z, se dice que la relaci贸n era esp煤rea.
    En otras palabras, la relaci贸n dependendia de la influencia de Z y no de una conexi贸n directa entre X e Y.

Sobre la regresi贸n lineal m煤ltiple:

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("pd12_diap1.png") 
```

------------------------------------------------------------------------

Seguiremos los siguientes pasos para el an谩lisis:

1. Creaci贸n del modelo
2. Analizar si el modelo es v谩lido -> p value
3. 驴Qu茅 tanto explica mi modelo? -> Coeficiente de determinaci贸n - R2
4. 驴Las variables Xs aportan al modelo? -> p value de cada variable
5. 驴Qu茅 variable aporta m谩s? -> coeficientes estandarizados
6. Identificaci贸n de coeficientes y construcci贸 de la ecuaci贸

#Aplicaci贸n

```{r, warning=FALSE,message=FALSE}
library(rio)
library(dplyr)
library(ggplot2)
library(jtools)
```

```{r}
data = import("Data-provincias.xlsx")
str(data)
```

**驴Qu茅 factores explican se relacionan con el voto por Fuerza Popular (FP) en segunda vuelta a nivel provincial (2021)?**

## Ejercicios regresi贸n lineal simple

1. 驴Los a帽os de educaci贸n promedio en una provincia podr谩 ayudar a predecir el % de voto por Fuerza Popular en segunda vuelta?

### Creaci贸n del modelo

```{r}
modelo1=lm(FP~educacion,data=data)
summary(modelo1)
```

### Interpretaci贸n

#### Primero: p-value

Sabremos si la variable independiente impacta en la dependiente al revisar la significancia del p valor.

Establezcamos nuestras hip贸tesis:

-   H0: El modelo de regresi贸n no es v谩lido

-   H1: El modelo de regresi贸n es v谩lido (variable X aporta al modelo)

Como el p valor es **7.668e-08**, entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo s铆 es v谩lido como modelo de predicci贸n. Es decir, podemos decir que hay evidencia estad铆stica suficiente para afirmar que existe una relaci贸n significativa entre los a帽os de educaci贸n en promedio y el porcentaje de voto obtenido por Fuerza Popular en las provincias.

En otras palabras, podemos decir que los a帽os de educaci贸n en promedio *s铆 influyen* en el porcentaje de voto obtenido por Fuerza Popular en las provincias.

#### Segundo: pendiente/b

Explica c贸mo es el efecto de x en y. Para ello analizamos el valor del par谩metro de la pendiente.

En este caso, al ser este valor **3.8947**, concluimos que cada vez que el promedio de a帽os de educaci贸n aumenta en 1, el % de votos por Fuerza Popular aumenta en 3.89. Es decir, tenemos una *relaci贸n directa o positiva*.

#### Tercero: R^2^

Analizar cu谩nto de la variabilidad de la variable dependiente (y) es explicada por la variable independiente (x), para ello revisamor el **R^2^** (Multiple R-squared). Los valores van de 0 a 1. Mientras m谩s cercano est茅 el R2 a 1, mayor ser谩 la variabilidad explicada. El R2 es un indicador de ajuste del modelo.

En nuestro modelo, este arroj贸 el valor de **0.1393**, por lo que podemos concluir que aproximadamente el **13.9%** (0.1393\*100)del % de votos por Fuerza Popular es explicado por el promedio de a帽os de educaci贸n.

Esto significa que la cantidad de variabilidad explicada es baja; en este caso, los cambios en los a帽os de educaci贸n explican solo una peque帽a proporci贸n de la variaci贸n en el porcentaje de votos por Fuerza Popular.

#### Cuarto: Ecuaci贸n de la recta

Hallar la ecuaci贸n de la recta del modelo. Para lograrlo, revisemos los dos valores de la tabla que se encuentran en la columna de "Estimate", el valor de la primera fila es el del intercepto (a) y el de la segunda es el de la pendiente (b).

Del segundo paso, ya conoc铆amos que el valor de la pendiente es **+3.8947** Si volvemos a revisar nuestra tabla podemos observar que en el cruce de Estimate e Intercept est谩 el valor de **5.3652**, este ser铆a nuestro intercepto. Ahora, armemos nuestra ecuaci贸n de la recta:

$$
Y = 5.36520 + (3.89471)\times \text{educacion}
$$

**Y =  5.36520 +3.89471X**

Donde:

-   X = A帽os de educaci贸n en promedio - (independiente)
-   Y = % de voto por Fuerza Popular - (dependiente)

Tambi茅n podemos obtener los coeficientes de intercepci贸n/intercepto y pendiente de la siguiente forma:

```{r}
modelo1$coefficients
```

#### Quinto: Predecir

Sustituyendo el valor de "x" en la ecuaci贸n, tenemos:

Para realizar una predicci贸n debemos proponer un valor que se encuentre dentro de los valores de la X.
```{r}
summary(data$educacion)
```

Como educaci贸n puede ir de 3 a 11, podemos proponer cualquier valor dentro de ese rango. Veamos qu茅 se espera de una provincia en la que los a帽os de educaci贸n en promedio sean 11.


```{r}
Y =  5.36520 +3.89471*11
Y
```

Cuando los a帽os de educaci贸n en promedio son 11, se espera que en esa provincia Fuerza Popular haya obtenido un 48 % de los votos. 

## Ejercicios regresi贸n lineal m煤ltiple

驴Qu茅 sucede si agregamos una variable a nuestro modelo anterior?

**驴Los a帽os de educaci贸n y los ingresos mensuales en promedio en una provincia pueden ayudar a explicar el porcentaje de voto que obtuvo Fuerza Popular?**

## **Modelo 2**

```{r}
modelo2 = lm(FP ~ educacion + ingresos, data)
summary(modelo2)
```

## **Interpretamos **

### **驴El modelo es v谩lido?**

Establezcamos nuestras hip贸tesis:

-   H0: El modelo de regresi贸n no es v谩lido
-   H1: El modelo de regresi贸n es v谩lido (las variables independientes aportan al modelo)

Luego nos fijamos en el **p-value** Como el p valor es \< 6.291e-11 entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo es v谩lido como modelo de predicci贸n.

### **驴Qu茅 tanto explica el modelo?**

Observamos el **R2 ajustado**.

Analizar cu谩nto de la variabilidad de la variable dependiente (y) es explicada por las variables independientes elegidas, para ello revisamos el R2 (Adjusted R-squared, por ser un modelo lineal m煤ltiple). 

En nuestro modelo, este arroj贸 el valor de 0.2089 , por lo que podemos concluir que el modelo explica aproximadamente el 20.89% (0.2089\*100) de la variabilidad en el % de votos que obtuvo Fuerza Popular (variable dependiente). 

*Recordemos que el R cuadrado puede tomar valores entre 0 y 1. Un R cuadrado de 1 indica que el modelo explica toda la variabilidad de la variable Y. Un R cuadrado de 0 indica que el modelo no explica nada de la variabilidad de la variable Y.*

### **驴Las variables aportan al modelo?**

Revisamos **p-value** por cada variable independiente.

-   Esperamos obtener un p-value \<0.05.
-   Nos damos cuenta que *no todas* las variables independientes tienen un p-value \<0.05, es el caso de: educaci贸n

### **驴Cu谩les son los coeficientes de la ecuaci贸n?**

Podemos obtener extraer los coeficientes del modelo: 

*No olvidar identificar el signo de cada coeficiente, este tendr谩 repercusi贸n en la ecuaci贸n y su futura aplicaci贸n*

```{r}
round(modelo2$coefficients,3)
```

De esa manera puedo hallar la ecuaci贸n:

$$
Y = 17.445 + (-0.821) \times  \text{educacion}  + (0.032)\times  \text{ingresos} 
$$

Es decir, se tienen las siguientes relaciones entre VD y las VI:

- Por cada sol adicional en ingresos, el % de voto por Fuerza Popular **aumenta en 0.032 puntos**. (relaci贸n directa).

- Por cada a帽o de educaci贸n adicional , el % de voto por Fuerza Popular **disminuye en 0.821 puntos** (relaci贸n inversa). Sin embargo, esta variable no tiene un impacto significativo en la predicci贸n.

**OJO: La ecuaci贸n de la recta debe incluir TODAS las variables analizadas, tengan o no una influencia significativa en la VD.**

**驴Los a帽os de educaci贸n, los ingresos mensuales en promedio y el tener IDH alto o no en una provincia pueden ayudar a explicar el porcentaje de voto que obtuvo Fuerza Popular?**


## **Modelo 3**

```{r}
library(fastDummies)
data = dummy_cols(data, select_columns="IDH_cat")
names(data)
```

```{r}
modelo3 = lm(FP ~ educacion + ingresos +IDH_cat_Alto, data)
summary(modelo3)
```
1. 驴El modelo es v谩lido?
2. Cuanto ayuda a explicar
3. 驴Todas las variables aportan?
4. 驴C贸mo es el impacto de las variables?
5. 驴Qu茅 variable aporta m谩s?
6. Ecuaci贸n 

```{r}
modelo3$coefficients
```


### **驴Qu茅 variable aporta m谩s?**

Para interpretar c贸mo cada variable independiente contribuye a la variabilidad de la variable dependiente, podemos usar los coeficientes estandarizados. Estos coeficientes nos ayudan a comparar, en una misma escala, el impacto que tiene cada variable independiente sobre la variable dependiente, permiti茅ndonos identificar cu谩les tienen un efecto m谩s fuerte.

```{r}
library(jtools)
summ(modelo3, scale=T)
```
Los resultados anteriores nos demuestran que las variables con mayor impacto son ingresos (11.56) y IDH_cat_Alto (-9.65)

```{r}
plot_summs(modelo1,modelo2,modelo3, scale = T)
```

