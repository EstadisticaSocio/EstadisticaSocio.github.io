---
title: "Pr√°ctica dirigida 5"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: flatly
    highlight: textmate
    always_allow_html: yes
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**

Curso: SOC294 - Estad√≠stica para el an√°lisis sociol√≥gico 1

Semestre 2024 - 2

## **Tablas de contingencia**

-   Son tablas de doble entrada, en las cuales se cruzan las categor√≠as
    de dos variables de inter√©s.

-   En las casillas de la tabla se ubica la frecuencia o el n√∫mero de
    casos de cada cruce.

-   Conceptos importantes: Frecuencias observadas y frecuencias
    esperadas.

```{r, echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("Tabla_contingencia1.png") 
```

## **Frecuencias observadas y esperadas**

-   Frecuencia esperada: Estas son las frecuencia que deber√≠an darse si
    las variables fueran independientes.

-   Frecuencia observada: Estas son las frecuencias reales que se
    observa en nuestra data.

Ejemplo:

```{r, echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("Tabla_contingencia2.png") 
```

# **Prueba Chi2**

Chi2 es una prueba para estimar el grado de asociaci√≥n entre variables
categ√≥ricas:

-   ‚ÄúNominal - Nominal‚Äù,

-   ‚ÄúNominal - Ordinal‚Äù

-   ‚ÄúOrdinal - Ordinal‚Äù

Esto significa que una parte de la variabilidad de una variable puede
ser explicada por otra variable.

Supuestos:

Para analizar asociaci√≥n se requiere que el n√∫mero de observaciones
esperadas en cada celda de la tabla de contingencia debe ser
suficientemente grande.

Para fines de este curso, al menos cada celda de la tabla de
contingencia de frecuencias esperadas debe ser de 5.

Ten en cuenta que si estas condiciones no se cumplen, entonces la prueba
podr√≠a no funcionar adecuadamente y los resultados de la prueba podr√≠an
no ser v√°lidos.

Hip√≥tesis:

-   Hip√≥tesis nula (H0): Las variables son estad√≠sticamente
    independientes (No hay asociaci√≥n) üö´

-   Hip√≥tesis alternativa (H1): Las variables son estad√≠sticamente
    dependientes (S√≠ hay asociaci√≥n)‚úÖ

Que dos variables est√©n asociadas significa que parte de la variabilidad
en una variable puede ser explicada por la otra variable.

El Chi2 espec√≠fica grado de asociaci√≥n, **NO LA FORMA DE ASOCIACI√ìN**.

# **Ejercicio**

Para la clase de hoy, se usar√° la base de datos de la ENPOVE 2022, el
m√≥dulo de empleo. Esta "es una investigaci√≥n estad√≠stica que permite
suministrar informaci√≥n estad√≠stica que refleje la situaci√≥n migratoria
de la poblaci√≥n venezolana refugiada y migrante en el Per√∫, con √©nfasis
en el contexto de la pandemia por la COVID-19, para as√≠ apoyar a tomar
las decisiones de pol√≠tica p√∫blica basadas en datos s√≥lidos y
confiables"

```{r, echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("DicPD5.png") 
```

```{r}
library(rio) #Convocamos el paquete   
data=import("PD5_enpove2022.sav")
```

## **¬øExiste una relaci√≥n significativa entre el estrato con el env√≠o deremesas?**

**PASO 1: Tabla de contingencia**

```{r}
library(dplyr)
data = data %>% 
  mutate(estrato = factor(estrato,labels=c("Bajo","Medio bajo","Medio","Medio alto","Alto"))) %>% 
  mutate(remesas = factor(remesas,labels=c("S√≠","No")))
```

```{r}
table(data$remesas)
```

```{r}
tabla1=table(data$estrato,data$remesas)
tabla1
```

Revisamos el supuesto

```{r}
chisq.test(tabla1)$expected
```

En este caso s√≠ cumple el supuesto!üòé

Creamos porcentajes por columna, para ello tenemos que agregar
prop.table al comando anterior. El argumento de prop.table puede ser

1: para calcular porcentaje por fila

2: para calcular por columna ‚ö†Ô∏è Recuerda que es recomendable calcular
los porcentajes sobre la variable sociodemogr√°fica o aquella que
antecede a la otra.

```{r}
tablapor1 = tabla1 %>%
           prop.table(1) %>%  
           round(2) #redondear el resultado a 2 decimales
tablapor1
```

**PASO 2: Tabla de contingencia**

```{r}
toPlot1 = as.data.frame(tablapor1) 
names(toPlot1) = c("Estrato", "Remesa", "Porcentaje")
```

```{r}
library(ggplot2)
  ggplot(toPlot1, aes(x=Estrato, y=Porcentaje*100, fill=Remesa)) +
  geom_bar(position="stack", stat="identity")+ #Stack indica que son barras apiladas
  geom_text(aes(label=paste0(Porcentaje*100,"%")), 
            position = position_stack(vjust = 0.5), 
             size = 4,
             fontface="bold")+
  labs(x="Estrato", y="Porcentaje", fill="¬øEnv√≠a remesa?")+
  theme_minimal()
```

De forma preliminar ¬øHay diferencias entre la forma c√≥mo se distribuye
la variable ‚ÄúSituaci√≥n Econ√≥mica‚Äù en cada subgrupo (hombre y mujer)?

**PASO 3: Prueba Chi2**

```{r}
chisq.test(tabla1)
```
De acuerdo al p-value obtenido en la prueba de hip√≥tesis de Chi2, al ser menor de 0.05, podemos rechazar la hip√≥tesis nula (Las variables son independientes)

Por lo tanto, podemos concluir que existe dependencia entre las variables escogidas. Esto quiere decir que el estrato S√ç se vincula con el env√≠o de remesas. 