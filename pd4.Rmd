---
title: "Pr치ctica dirigida 4"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: flatly
    highlight: textmate
    always_allow_html: yes
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**

Curso: SOC294 - Estad칤stica para el an치lisis sociol칩gico 1

Semestre 2024 - 2

## **Recordando lo avanzado**

En la sesi칩n anterior de teor칤a, nos adentramos al an치lisis inferencial
bivariado, teniendo como base del tema el c치lculo del Intervalo de
Confianza (IC) para una media (variables num칠ricas) y para una
proporci칩n (variables categ칩ricas). Recordemos que gracias al IC podemos
determinar si la estimaci칩n es representativa de la poblaci칩n. La idea
era calcular los intervalos de confianza para cada grupo y ver si los
intervalos se interceptan o no. La regla era que si los intervalos de
ambos grupos no se interceptaban, pod칤amos extrapolar que la diferencia
muestral existe en la poblaci칩n al 95% de confianza. Para profundizar
sobre estad칤stica inferencial, evaluaremos las hip칩tesis mediante la
introducci칩n a la prueba t de diferencia de medias y desarrollaremos los
cincos pasos de la inferencia estad칤stica. Recordemos que el objetivo es
corroborar que es posible extrapolar un resultado de la muestra a la
poblaci칩n.

# **Prueba T**

## **쯈u칠 es la prueba T de diferencia de medias?**

Generalmente, cuando queremos comparar dos grupos centramos nuestra
atenci칩n en el promedio de cada uno. Sin embargo, el hecho de que los
promedios sean distintos no supone, necesariamente, que existe una
diferencia estad칤sticamente significativa.

Para saber si la diferencia observada entre las medias de dos grupos es
o no significativa se emplean m칠todos param칠tricos como el de Z-scores o
la distribuci칩n T-student. Estas t칠cnicas calculan los intervalos de
confianza de cada grupo y concluyen si existe una diferencia real entre
las medias.

La prueba T compara la media de una variable num칠rica para dos grupos o
categor칤as de una variable nominal u ordinal. Los grupos que forman la
variable nominal/ordinal tienen que ser independientes. Es decir, cada
observaci칩n debe pertenecer a un grupo o al otro, pero no a ambos.

## **Pruebas T para muestras independientes**

*Condiciones*

1.  Independencia: Las muestras deben ser independientes. El muestreo
    debe ser aleatorio.

2.  Igualdad de varianza: La varianza de ambas poblaciones comparadas
    debe ser igual.

3.  La variable num칠rica se distribuye de manera normal.

***IMPORTANTE***

La condici칩n de normalidad tambi칠n es considerada si es que la muestra
fuera peque침a (Agresti y Finlay proponen que se aplica con un n peque침o
menor a 30 observaciones). A medida que el n se hace m치s grande, el
supuesto de normalidad es menos importante pues con grandes n confiamos
en el teorema del l칤mite central que nos indica que la distribuci칩n
muestral ser치 siempre normal.

## **Pasos para realizar la Prueba T**

1.  Establecer hip칩tesis

2.  Calcular el estad칤stico (par치metro estimado) que se va a emplear

3.  Determinar el nivel de significancia 풤 (alpha)

4.  Calcular el p-value y realizar la prueba prop.test

5.  Interpretar

**Recuerda**

El H0 de la prueba T es la siguiente:

**H0:** No existe diferencia estad칤sticamente significativa entre las
medias de los dos grupos comparados.

**H1:** S칤 existe diferencia estad칤sticamente significativa entre las
medias de los dos grupos comparados.

*La H0 es generalmente la hip칩tesis de no efecto, de no diferencias.*

# **Apliquemos**

### **Insertar pregunta general 游뱂**

Para dar respuesta a la pregunta de investigaci칩n que guiara la pr치ctica
dirigida analizaremos algunas de las variables que forman parte de la
Encuesta Nacional de Percepci칩n de Desigualdades - ENADES 2024, que fue
elaborada por Instituto de Estudios Peruanos (IEP) y Oxfam. La encuesta
busca ahondar en la percepci칩n de las diferentes formas de desigualdad
en el Per칰 e incorpora indicadores que permiten medir la magnitud de
brechas sociales y pol칤ticas como g칠nero, clase, entre otros.

Se eligieron algunas variables de la base de datos original y se dejaron
por fuera valores perdidos adem치s de realizar otras modificaciones. Para
realizar alguna investigaci칩n se debe usar la base de datos original que
se encuentra en el siguiente [link](https://peru.oxfam.org/ENADES-2024).

```{r}
library(rio)
data = import("pd4_enades2024.sav")
```

```{r, echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("PruebaT-Diccionario.jpeg") 
```

## 1. 쮼xiste una diferencia estad칤sticamente significativa entre la estimaci칩n del monto m칤nimo mensual del hogar seg칰n nivel educativo alcanzado?

Crearemos una tabla con la media, m치ximo y m칤nimo de la variable
nivel_discriminaci칩n, en base al grupo de edu2

Agreguemos etiquetas:

```{r}
library(dplyr)
data = data  %>%  
  mutate(edu2 = factor(edu2, levels = 1:2, labels = c("E. B치sica","E. Superior")))

```

```{r}
library(lsr)
NivelEdu = data %>% 
  group_by(edu2)  %>% 
  summarize(Media = mean(P15, na.rm = T),
  min = ciMean(P15, na.rm=T)[1],
  max = ciMean(P15, na.rm=T)[2])
NivelEdu
```

```{r}
NivelEdu[2,2] - NivelEdu[1,2] 
```

La diferencia es de aprox 1124 soles. 쯇uedo afirmar que existe esta
diferencia en la poblaci칩n?

Para poder evaluar si existen o no diferencias poblacionales usaremos
t.test.

Recuerda que primero se indica la variable num칠rica y luego la
categor칤ca dicot칩mica.

```{r}
t.test(P15 ~ edu2, data = data)
```

El valor p- value es \< 2.2e-16, que es menor que el nivel t칤pico de
significancia (generalmente 풤 = 0.05). Un valor p alto sugiere que no
hay suficiente evidencia para rechazar la hip칩tesis nula. En otras
palabras, podemos concluir que existe una diferencia significativa entre
las medias de los dos grupos (Educaci칩n B치sica y Educaci칩n Superior) con
respecto a la variable P15

Graficamos los resultados

```{r}
library(ggplot2)
ggplot(NivelEdu, aes(x = edu2, y = Media)) +
  geom_errorbar(aes(ymin = min, ymax = max), width = 0.2) +
  ggtitle("Estimaci칩n del monto m칤nimo mensual del hogar \nseg칰n m치ximo nivel educativo") +
  # Etiquetas de la media
  geom_text(aes(label = paste(round(Media, 2))), vjust = 0.5, size = 3) +
  # Etiquetas de los valores m칤nimos
  geom_text(aes(y = min, label = paste("min:", round(min, 2))), 
            vjust = 1.5, hjust = -0.6, size = 2, color = "#00688B") +
  # Etiquetas de los valores m치ximos
  geom_text(aes(y = max, label = paste("max:", round(max, 2))), 
            vjust = -0.5, hjust = -0.6, size = 2, color = "#00688B") +
    theme_light()+
  xlab("M치ximo nivel educativo alcanzado") + 
  ylab("Promedio del gasto m칤nimo mensual") 

```

## 2. 쮼xiste una diferencia en el nivel de acuerdo con la frase "los que m치s tienen deber칤an pagar m치s impuestos" seg칰n si la persona pertenece a una clase social alta o media alta o no?

Para responder a la pregunta identifiquemos la variable num칠rica y la
categ칩rica primero.

La variable n칰merica es la P30, que es una likert y va del 1 al 10.

La categ칩rica se basa en **clase**, todo lo que sea 1 o 2 (Clase
Alta/Media Alta) ser치 "Alta/Media alta" y lo que no, ser치 "No alta/media
alta".

```{r}
table(data$clase)
data = data %>% 
  mutate(Clase2= ifelse(clase <3, "Alta/Media alta", "No alta/Media alta" ))

```

쮿ay diferencia entre ambos grupos en la muestra?

```{r}
clase = data %>% 
  filter(!is.na(Clase2)) %>% 
  group_by(Clase2)  %>% 
  summarize(Media = mean(P30, na.rm = T),
  min = ciMean(P30, na.rm=T)[1],
  max = ciMean(P30, na.rm=T)[2])
clase
```

El an치lisis descriptivo muestra que las medias de ambos grupos se
encuentran a 0.6 puntos de distancia.

Para poder evaluar si existen o no diferencias poblacionales usaremos
t.test.

```{r}
t.test(P30 ~ Clase2, data = data)
```

```{r}
ggplot(clase, aes(x = Clase2, y = Media)) +
  geom_errorbar(aes(ymin = min, ymax = max), width = 0.2) +
  ggtitle("Estimaci칩n del nivel de acuerdo con 'Los que m치s \ntienen deber칤an pagar m치s impuestos' seg칰n clase") +
  # Etiquetas de la media
  geom_text(aes(label = paste(round(Media, 2))), vjust = 0.5, size = 3) +
  # Etiquetas de los valores m칤nimos
  geom_text(aes(y = min, label = paste("min:", round(min, 2))), 
            vjust = 1.5, hjust = -0.6, size = 2, color = "#00688B") +
  # Etiquetas de los valores m치ximos
  geom_text(aes(y = max, label = paste("max:", round(max, 2))), 
            vjust = -0.5, hjust = -0.6, size = 2, color = "#00688B") +
  theme_light()+
  xlab("쮼s de clase alta o media alta?") + 
  ylab("Promedio del nivel de acuerdo con \nLos que m치s tienen deber칤an pagar m치s impuestos") 
```

Ejercicios:

1.  Analiza si existen diferencias en la poblaci칩n entre el promedio de
    monto estimado para vivir (P15) entre hombres y mujeres (sexo) con
    la prueba, el gr치fico y la interpretaci칩n correspondiente.
2.  Analiza si existen diferencias en la poblaci칩n entre el nivel de
    acuerdo con la frase que indica que solo se gobierna para Lima(P29)
    entre si el encuestad\@ vive en Lima o no (variable basada en
    macrozona) con la prueba, el gr치fico y la interpretaci칩n
    correspondiente. Para ello debe de crear previamente una variable
    llamada Lima que se base en macrozona, si macrozona es Lima,
    entonces la nueva variable tambi칠n ser치 "Lima", todo lo dem치s ser치
    "No Lima".
