---
title: "Práctica dirigida 2"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: flatly
    highlight: textmate
    always_allow_html: yes
---

**FACULTAD DE CIENCIAS SOCIALES - PUCP**

Curso: SOC294 - Estadística para el análisis sociológico 1

Semestre 2024 - 2

# **1.¿Qué es el análisis descriptivo?**

```{r,echo=FALSE, out.width="80%",fig.align="center"}
knitr::include_graphics("pd2_QSAnalisisDesc.png") 
```

# **2.Nivel de medida de una variable**

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("pd2_medVar.png") 
```

# **3.Importancia de visualización de datos**

Debido al crecimiento de la big data en los últimos años surgieron nuevas necesidades para comprender los análisis masivos de datos de una forma simple y escalable. Es entonces cuando se dirige la atención a desarrollar nuevas técnicas gráficas en distintas plataformas (ejemplos a continuación), tanto softwares como librerías de código abierto[^1], tal es el caso de ggplot2 en R.

[^1]: <https://www.data-to-viz.com/caveat/pie.html>

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_herramientas.png") 
```

Este interés por desarrollar técnicas de análisis masivo de datos y la comunicación de resultados cada vez más amigables y apta para todos los públicos dio pie a nuevas especialidades dentro de la ciencia de datos, como por ejemplo el data story telling

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_datavis.png") 
```

### **Gráficos por tipo de variables:**

```{r,echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("pd2_GrafTipoVar.png") 
```

# **4.Análisis descriptivo**

```{=html}
<style>
.custom-text {
  color: #00688B;
  font-family: Helvetica, sans-serif;
  text-align: center;
  font-weight: bold;
  font-size: 22px;
}
</style>
```
::: custom-text
::: custom-text
¿Cuál es la distribución y dinámica de las manifestaciones sociales en el Perú? 🤔
:::
:::

Para la sesión de hoy se usará la **"Base de eventos de protesta (1980 - 2023)",** agregada a nivel regional. Esta fue inicialmente creada por Moisés Arce, profesor de la Universidad de Tulane, y recientemente actualizada por la Escuela de Gobierno y Políticas Públicas de la PUCP. Esta base es un aporte para estudiar y comprender mejor la dinámica de la conflictividad popular en el Perú desde 1980 hasta la actualidad. Encuentra más información y la base de datos original en el siguiente [link](https://democracia-gobernabilidad.pucp.edu.pe/participaci%C3%B3n/protestas-sociales).

```{r,message=FALSE,warning=FALSE}
library(rio)
data = import("pd2_Protestas.xlsx")
```

Agregar diccionario

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("pd2_diccionario.png") 
```

## 4.1 ¿Cómo se distribuye (%) las protestas en el Perú a nivel regional?

Abrimos la librería dplyr

```{r, warning=FALSE,message=FALSE}
library(dplyr)
```

Comprobamos el tipo de variable que queremos utilizar

```{r}
class(data$Región)
```

Creamos un summarise donde se encuentre la región y su frecuencia

```{r}
data %>% 
  group_by(Región) %>% 
  summarise(Total = sum(Total))
```

Es posible crear una table que incluya tanto frecuencias como porcentajes añadiendo una línea al comando anterior. Además, para poder representar los resultados en un gráfico, necesitamos guardar esta tabla en un objeto. Usemos esta tabla resumida y asignémosle el nombre gráfico1, de manera que podamos referirnos a ella cuando creemos el gráfico

```{r}
gráfico1 <- data %>% 
  group_by(Región) %>% 
  summarise(Total = sum(Total)) %>% 
  mutate(Porcentaje = (Total / sum(Total))*100)

gráfico1
```

Un breve ejemplo. Podemos realizar la misma situación, inclusive, filtrando. En este caso, nos quedamos solamente con aquellas regiones que tienen por sector común a la ciudadanía. Podemos filtrar de distintas maneras.

```{r}
data %>% filter(Sector_comun=="Ciudadanía") %>% 
  group_by(Región) %>% 
  summarise(Total = sum(Total)) %>% 
  mutate(Porcentaje = (Total / sum(Total))*100)
```

Graficamos "gráfico1" con todas las regiones del Perú

```{r}
library(ggplot2)

ggplot(gráfico1, aes(x=Región, y=Porcentaje, fill=Región)) + 
  geom_bar(stat = "identity") 
```

El gráfico anterior, sin embargo, posee demasiada información, por lo cual es difícil de observar con claridad. Por lo cual, nos quedaremos solamente con las 5 regiones con mayores porcentajes de protestas sociales, llamándolo "gráfico2"

```{r}
gráfico2 <- data %>%
  group_by(Región) %>% 
  summarise(Total = sum(Total)) %>% 
  mutate(Porcentaje = (Total / sum(Total))*100) %>%
  arrange(desc(Porcentaje)) %>%   
  top_n(5, Porcentaje)

gráfico2
```

Graficamos con las nuevas modificaciones añadidas

```{r}
ggplot(gráfico2, aes(x=Región, y=Porcentaje, fill=Región)) + 
  geom_bar(stat = "identity")
```

Podemos personalizar nuestros gráficos de la manera que deseemos.

```{r}
library(tayloRswift)

ggplot(gráfico2, aes(x=Región, y=Porcentaje, fill=Región)) + 
  geom_bar(stat = "identity")  +
  ggtitle("Las 5 provincias del Perú con mayor porcentaje de protestas") +
  xlab("Región") + ylab("Porcentaje")+
  geom_text(aes(label=round(Porcentaje,1)), vjust=1.3, color="black", size=3)+
  theme(panel.background=element_rect(fill = "white", colour = "white")) +
  scale_fill_taylor(palette = "taylor1989") #fearless, speakNow, Red
```
