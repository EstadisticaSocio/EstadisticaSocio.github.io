---
title: "Pr치ctica dirigida 2"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: flatly
    highlight: textmate
    always_allow_html: yes
---

**FACULTAD DE CIENCIAS SOCIALES - PUCP**

Curso: SOC294 - Estad칤stica para el an치lisis sociol칩gico 1

Semestre 2024 - 2

# **1.쯈u칠 es el an치lisis descriptivo?**

```{r,echo=FALSE, out.width="80%",fig.align="center"}
knitr::include_graphics("pd2_QSAnalisisDesc.png") 
```

# **2.Nivel de medida de una variable**

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("pd2_medVar.png") 
```

# **3.Importancia de visualizaci칩n de datos**

Debido al crecimiento de la big data en los 칰ltimos a침os surgieron nuevas necesidades para comprender los an치lisis masivos de datos de una forma simple y escalable. Es entonces cuando se dirige la atenci칩n a desarrollar nuevas t칠cnicas gr치ficas en distintas plataformas (ejemplos a continuaci칩n), tanto softwares como librer칤as de c칩digo abierto[^1], tal es el caso de ggplot2 en R.

[^1]: <https://www.data-to-viz.com/caveat/pie.html>

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_herramientas.png") 
```

Este inter칠s por desarrollar t칠cnicas de an치lisis masivo de datos y la comunicaci칩n de resultados cada vez m치s amigables y apta para todos los p칰blicos dio pie a nuevas especialidades dentro de la ciencia de datos, como por ejemplo el data story telling

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_datavis.png") 
```

### **Gr치ficos por tipo de variables:**

```{r,echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("pd2_GrafTipoVar.png") 
```

# **4.An치lisis descriptivo**

```{=html}
<style>
.custom-text {
  color: #00688B;
  font-family: Helvetica, sans-serif;
  text-align: center;
  font-weight: bold;
  font-size: 22px;
}
</style>
```
::: custom-text
::: custom-text
쮺u치l es la distribuci칩n y din치mica de las manifestaciones sociales en el Per칰? 游뱂
:::
:::

Para la sesi칩n de hoy se usar치 la **"Base de eventos de protesta (1980 - 2023)",** agregada a nivel regional. Esta fue inicialmente creada por Mois칠s Arce, profesor de la Universidad de Tulane, y recientemente actualizada por la Escuela de Gobierno y Pol칤ticas P칰blicas de la PUCP. Esta base es un aporte para estudiar y comprender mejor la din치mica de la conflictividad popular en el Per칰 desde 1980 hasta la actualidad. Encuentra m치s informaci칩n y la base de datos original en el siguiente [link](https://democracia-gobernabilidad.pucp.edu.pe/participaci%C3%B3n/protestas-sociales).

```{r,message=FALSE,warning=FALSE}
library(rio)
data = import("pd2_Protestas.xlsx")
```

Agregar diccionario

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("pd2_diccionario.png") 
```

## 4.1 쮺칩mo se distribuye (%) las protestas en el Per칰 a nivel regional?

Abrimos la librer칤a dplyr

```{r, warning=FALSE,message=FALSE}
library(dplyr)
```

Comprobamos el tipo de variable que queremos utilizar

```{r}
class(data$Regi칩n)
```

Creamos un summarise donde se encuentre la regi칩n y su frecuencia

```{r}
data %>% 
  group_by(Regi칩n) %>% 
  summarise(Total = sum(Total))
```

Es posible crear una table que incluya tanto frecuencias como porcentajes a침adiendo una l칤nea al comando anterior. Adem치s, para poder representar los resultados en un gr치fico, necesitamos guardar esta tabla en un objeto. Usemos esta tabla resumida y asign칠mosle el nombre "gr치fico1", de manera que podamos referirnos a ella cuando creemos el gr치fico

```{r}
gr치fico1 <- data %>% 
  group_by(Regi칩n) %>% 
  summarise(Total = sum(Total)) %>% 
  mutate(Porcentaje = (Total / sum(Total))*100)

gr치fico1
```

Un breve ejemplo. Podemos realizar la misma situaci칩n, inclusive, filtrando. En este caso, nos quedamos solamente con aquellas regiones que tienen por sector com칰n a la ciudadan칤a. Podemos filtrar de distintas maneras.

```{r}
data %>% filter(Sector_comun=="Ciudadan칤a") %>% 
  group_by(Regi칩n) %>% 
  summarise(Total = sum(Total)) %>% 
  mutate(Porcentaje = (Total / sum(Total))*100)
```

Graficamos "gr치fico1" con todas las regiones del Per칰

```{r}
library(ggplot2)

ggplot(gr치fico1, aes(x=Regi칩n, y=Porcentaje, fill=Regi칩n)) + 
  geom_bar(stat = "identity") + 
  theme_bw()
```

El gr치fico anterior, sin embargo, posee demasiada informaci칩n, por lo cual es dif칤cil de observar con claridad. Por lo cual, nos quedaremos solamente con las 5 regiones con mayores porcentajes de protestas sociales, llam치ndolo "gr치fico2"

```{r}
gr치fico2 <- data %>%
  group_by(Regi칩n) %>% 
  summarise(Total = sum(Total)) %>% 
  mutate(Porcentaje = (Total / sum(Total))*100) %>%
  arrange(desc(Porcentaje)) %>%   
  top_n(5, Porcentaje)

gr치fico2
```

Graficamos con las nuevas modificaciones a침adidas

```{r}
ggplot(gr치fico2, aes(x=Regi칩n, y=Porcentaje, fill=Regi칩n)) + 
  geom_bar(stat = "identity")+
  theme_classic()
```

Podemos personalizar nuestros gr치ficos de la manera que deseemos.

```{r}
library(tayloRswift)

ggplot(gr치fico2, aes(x=Regi칩n, y=Porcentaje, fill=Regi칩n)) + 
  geom_bar(stat = "identity")  +
  ggtitle("Las 5 provincias del Per칰 con mayor porcentaje de protestas") +
  xlab("Regi칩n") + ylab("Porcentaje")+
  geom_text(aes(label=round(Porcentaje,1)), vjust=1.3, color="black", size=3)+
  theme(panel.background=element_rect(fill = "white", colour = "white")) +
  scale_fill_taylor(palette = "taylor1989") #fearless, speakNow, Red
```

## 4.2 쮺u치nta diversidad de acciones violentas hay a nivel regional?

### **Indicador Proxy**

Tambie패n llamado indicador indirecto, se usa ante la imposibilidad de medir lo que efectivamente es de importancia. El indicador mide una variable distinta a la que nos interesa de manera especi패fica, pero presenta una relacio패n lo ma패s directa posible con el feno패meno en estudio.

Un indicador proxy es una medici칩n o se침al indirecto que aproxima o representa un fen칩meno en la ausencia de una medici칩n o se침al directo.

### **Indicador Aditivo**

Es una variable latente que se genera a trav칠s de la suma de un conjunto de variables manifiestas u observables. Luego de la suma se procede a aplicar una formula que genera que el valor m치ximo de la variable sea 1 y el m칤nimo sea 0. A partir de eso se puede multiplicar por cualquier n칰mero para que el m치ximo cambie. Es as칤 que si se multiplica por 10, el indicador ir치 de 0 a 10; si se desea que el indicador sea de 0 a 50, se debe multiplicar por 50; etc.

```{r,echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("pd2_ejemplo.png") 
```

Sin embargo, el paquete scales nos facilita el uso del comando **rescale.** Al usarlo solo necesitamos se침alar los l칤mites del indicador.

#### Pasos para construir un indicador aditivo:

1.  Verificar que las variables que construyan el indicador correspondan al concepto que se desea medir. *Ejemplo: Si deseo mejor Satisfacci칩n del Usuario, las preguntas deben ser sobre ello.*
2.  Revisar el cuestionario e identificar el sentido de las categor칤as. *Ejemplo: El valor 5 es "Muy instafisfecho" y 1 "Muy satisfecho".*
3.  Si las categor칤as de las variables est치n en el correcto sentido proceder a sumarlas, si no lo est치n, proceder a recodificarlas para luego sumar.
4.  Aplicar la funci칩n **rescale** (paquete scales) indicando los l칤mites del indicador, recuerda que sin la suma no podr치s generar el indicador.

## 4.2.1 Indicador aditivo de diversidad de acciones violentas.

Construiremos un indicador aditivo de diversidad de acciones violentas en el Per칰 que vaya del 0 al 10. Para ello usaremos a las variables: Agre, Aped, Destruc, Dolor auto, Invasi칩n, Lanzam, Motin, Quemas, Saqueo, Secues, Toma. En estas variables el valor 0 quiere decir que no hubo protestas que usen esa acci칩n para protestar en la regi칩n y a침o indicados; en caso el valor sea 1, quiere decir que s칤 hubo protestas (por lo menos una) que use esa acci칩n.

1.  Luego de verificar los pasos anteriores, creamos la suma

```{r}
data = data %>% 
  mutate(suma = Agre+ Aped+ Destruc+ Dolor_auto+ Invasi칩n+ Lanzam+ Motin+ Quemas+ Saqueo+ Secues+ Toma)
```

2.  Ahora, con la suma generada usamos la funci칩n **rescale** para crear un indicador que vaya del 0 al 10. De tal manera que una regi칩n que tenga valor 0 es una regi칩n en la que nunca se us칩 alguna acci칩n de fuerza; y una que obtuvo 10 es una regi칩n en la que se usaron todas las acciones posibles.

```{r, warning = FALSE,message=FALSE}
library(scales) #Para poder usar el paquete rescale
data = data %>%  
  mutate(indicador= rescale(suma, to=c(0,10)))
```

Ya que tenemos el indicador podemos analizarlo. Recuerda que si bien en esencia las variables que generaron el indicador son nominales (1. Si/0. No), el indicador es en s칤 una variable num칠rica. Al ser una num칠rica podemos analizar todas las medidas de tendencia central, las medidas de posici칩n y las de dispersi칩n.

```{r}
data %>% 
  summarise(
    Media = mean(indicador), 
    Mediana = median(indicador), 
    Desviacion = sd(indicador), 
    Minimo = min(indicador), 
    Maximo = max(indicador),
    Q1 = quantile(indicador, 0.25), #Primer cuartil
    Q3 = quantile(indicador, 0.75) #Tercer cuartil
  )
```

쮺칩mo podemos interpretar la tabla? Recuerda que cada observaci칩n es una regi칩n en un a침o determinado.

Para facilitar la visualizaci칩n podemos graficar la variable. Haremos un boxplot para ello. Tambi칠n podemos optar por un histograma.

```{r}
ggplot(data, aes(x=indicador))+
  geom_boxplot()+
  theme_bw()
```

```{r}
ggplot(data, aes(y=indicador))+
  geom_boxplot()+
  ggtitle("Indicador de diversidad de acciones violentas") +
  theme_bw()
```

El gr치fico muestra que en el 50% de regiones por a침o no se us칩 acciones violentas. Adem치s un 25% de regiones tuvo una diversidad de m치s de 2 puntos en el indicador de 0 a 10. Hubo regiones que en alg칰n a침o llegaron a usar el m치ximo de acciones violentas pero son casos at칤picos.

Podemos analizar la agrupaci칩n de todos los periodos y lo vemos seg칰n regi칩n. Para ello debemos agrupar el resumen anterior.

```{r}
data %>% 
  group_by(Regi칩n) %>% 
  summarise(
    Media = mean(indicador), 
    Mediana = median(indicador), 
    Desviacion = sd(indicador), 
    Minimo = min(indicador), 
    Maximo = max(indicador),
    Q1 = quantile(indicador, 0.25), #Primer cuartil
    Q3 = quantile(indicador, 0.75) #Tercer cuartil
  )
```

Podemos observar los resultados en un boxplot

```{r}
ggplot(data, aes(x=Regi칩n, y=indicador, color = Regi칩n)) +
  geom_boxplot() +
  coord_flip() +
  ggtitle("Indicador de diversidad de acciones violentas seg칰n regi칩n") +
  theme_bw()
```

# Ejercicio

1.  Analiza la variable N춿 de protestas pol칤ticas (R_pol_ord), genera el gr치fico respectivo e interpreta.
2.  Analiza la variable Total de protestas con reclamo laboral (R_lab)

**Para explorar otros comandos:**

Genera la variable "Laboral" que se base en sector_com칰n de tal manera que si es un reclamo laboral indica "Es laboral", si no lo es que indique "No laboral". Luego de crearla, analiza y genera el gr치fico apropiado. Finalmente, interpreta.
